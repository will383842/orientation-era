<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mon Avenir aprÃ¨s le Bac Pro ERA</title>

    <!-- PWA Meta Tags -->
    <meta name="description" content="DÃ©couvre les mÃ©tiers d'avenir aprÃ¨s ton Bac Pro ERA">
    <meta name="theme-color" content="#8b5cf6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Orientation ERA">

    <!-- Favicon & Icons -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="icon" type="image/svg+xml" href="/icons/icon.svg">
    <link rel="apple-touch-icon" href="/icons/icon-152.svg">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-192.svg">

    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #8b5cf6;
            --primary-light: #c4b5fd;
            --primary-dark: #7c3aed;
            --secondary: #ec4899;
            --accent: #06b6d4;
            --success: #10b981;
            --warning: #f59e0b;
            --bg: #faf5ff;
            --bg-white: #ffffff;
            --text: #1f2937;
            --text-light: #6b7280;
            --border: #e5e7eb;
            --shadow: 0 4px 20px rgba(139, 92, 246, 0.12);
            --shadow-lg: 0 10px 40px rgba(139, 92, 246, 0.2);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #faf5ff 0%, #fdf2f8 50%, #f0fdfa 100%);
            min-height: 100vh;
            color: var(--text);
            line-height: 1.6;
        }

        /* Header - Mobile First */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 1.25rem 0.75rem;
            text-align: center;
        }

        .header h1 {
            font-family: 'Outfit', sans-serif;
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 0.3rem;
        }

        .header p { opacity: 0.9; font-size: 0.85rem; }

        /* Container - Mobile First */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0.75rem;
        }

        /* Views */
        .view { display: none; }
        .view.active { display: block; }

        /* Cards - Mobile First */
        .card {
            background: var(--bg-white);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            box-shadow: var(--shadow);
        }

        .card-title {
            font-family: 'Outfit', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.6rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        /* Form elements */
        .form-group { margin-bottom: 1rem; }
        
        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.4rem;
            color: var(--text);
            font-size: 0.9rem;
        }

        .hint {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-bottom: 0.5rem;
        }

        input[type="text"], select, textarea {
            width: 100%;
            padding: 0.7rem 1rem;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 0.95rem;
            font-family: inherit;
            transition: border-color 0.2s;
            background: white;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Tags - Mobile First */
        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
        }

        .tag {
            background: var(--bg);
            border: 2px solid var(--border);
            padding: 0.35rem 0.5rem;
            border-radius: 20px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            user-select: none;
        }

        .tag:hover { border-color: var(--primary-light); background: white; }

        .tag.selected {
            background: linear-gradient(135deg, var(--primary-light), #fbcfe8);
            border-color: var(--primary);
            color: var(--primary-dark);
            font-weight: 500;
        }

        .tag .emoji { font-size: 0.9rem; }

        /* Slider */
        .slider-wrapper { padding: 0.5rem 0; }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(90deg, var(--success), var(--accent), var(--primary), var(--secondary));
            -webkit-appearance: none;
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: white;
            border: 3px solid var(--primary);
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: var(--text-light);
            margin-top: 0.4rem;
        }

        .slider-value {
            text-align: center;
            font-weight: 600;
            color: var(--primary);
            margin-top: 0.4rem;
            font-size: 0.9rem;
        }

        /* Buttons */
        .btn {
            padding: 0.8rem 1.4rem;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            font-family: inherit;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: var(--bg);
            color: var(--text);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover { border-color: var(--primary); }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Loading */
        .loading-container {
            text-align: center;
            padding: 2.5rem 1rem;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .loading-phases { margin-top: 1.5rem; text-align: left; max-width: 350px; margin-left: auto; margin-right: auto; }

        .phase-item {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            padding: 0.4rem 0;
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .phase-item.active { color: var(--primary); font-weight: 500; }
        .phase-item.done { color: var(--success); }

        .phase-icon {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            background: var(--border);
            flex-shrink: 0;
        }

        .phase-item.active .phase-icon {
            background: var(--primary);
            color: white;
        }

        .phase-item.done .phase-icon {
            background: var(--success);
            color: white;
        }

        /* Results */
        .profile-summary {
            background: linear-gradient(135deg, var(--primary-light), #fbcfe8);
            border-radius: 12px;
            padding: 0.75rem 1rem;
            margin-bottom: 1rem;
            font-size: 0.85rem;
        }

        .profile-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.3rem;
            margin-top: 0.4rem;
        }

        .profile-tag {
            background: white;
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
        }

        .tabs {
            display: flex;
            gap: 0.4rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            border: 2px solid var(--border);
            background: white;
            transition: all 0.2s;
        }

        .tab-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .tab-btn:hover:not(.active) { border-color: var(--primary-light); }

        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Report content */
        .report {
            line-height: 1.8;
            font-size: 0.92rem;
        }

        .report h1, .report h2, .report h3, .report h4 {
            font-family: 'Outfit', sans-serif;
            color: var(--primary-dark);
            margin: 1.25rem 0 0.6rem;
        }

        .report h1:first-child, .report h2:first-child, .report h3:first-child { margin-top: 0; }

        .report h2 { font-size: 1.2rem; border-bottom: 2px solid var(--primary-light); padding-bottom: 0.3rem; }
        .report h3 { font-size: 1.05rem; }

        .report ul, .report ol { margin: 0.6rem 0; padding-left: 1.4rem; }
        .report li { margin: 0.35rem 0; }
        .report strong { color: var(--secondary); }
        .report p { margin: 0.6rem 0; }

        .report table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            font-size: 0.85rem;
        }

        .report th, .report td {
            border: 1px solid var(--border);
            padding: 0.5rem;
            text-align: left;
        }

        .report th {
            background: var(--bg);
            font-weight: 600;
        }

        /* Expandable */
        .expandable {
            border: 2px solid var(--border);
            border-radius: 10px;
            margin-bottom: 0.75rem;
            overflow: hidden;
        }

        .expandable-header {
            padding: 0.75rem 1rem;
            background: var(--bg);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .expandable-header:hover { background: var(--primary-light); }

        .expandable-content {
            padding: 1rem;
            display: none;
            max-height: 400px;
            overflow-y: auto;
        }

        .expandable.open .expandable-content { display: block; }

        /* Search */
        .search-section {
            border-top: 2px solid var(--border);
            padding-top: 1rem;
            margin-top: 1rem;
        }

        .search-bar {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .search-bar input { flex: 1; min-width: 200px; }
        .search-bar select { width: auto; min-width: 130px; }
        .search-bar .btn { padding: 0.7rem 1rem; }

        .search-result {
            margin-top: 1rem;
            padding: 1rem;
            background: var(--bg);
            border-radius: 10px;
        }

        /* Chat */
        .chat-section {
            border-top: 2px solid var(--border);
            padding-top: 1rem;
            margin-top: 1rem;
        }

        .chat-messages {
            max-height: 250px;
            overflow-y: auto;
            margin-bottom: 0.75rem;
        }

        .chat-msg {
            padding: 0.6rem 0.9rem;
            border-radius: 12px;
            margin-bottom: 0.5rem;
            max-width: 85%;
            font-size: 0.9rem;
        }

        .chat-msg.user {
            background: var(--primary);
            color: white;
            margin-left: auto;
        }

        .chat-msg.ai { background: var(--bg); }

        .chat-input {
            display: flex;
            gap: 0.5rem;
        }

        .chat-input input { flex: 1; }

        /* Actions */
        .actions {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            margin-top: 1.5rem;
        }

        /* API Status */
        .api-status {
            display: flex;
            gap: 0.4rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 0.75rem;
            font-size: 0.75rem;
        }

        .api-badge {
            padding: 0.2rem 0.5rem;
            border-radius: 8px;
            background: var(--bg);
        }

        .api-badge.ok { background: #d1fae5; color: #047857; }
        .api-badge.error { background: #fee2e2; color: #b91c1c; }

        /* Favoris */
        .favorites-hint {
            font-size: 0.8rem;
            color: var(--text-light);
            background: var(--bg);
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .favorites-empty {
            text-align: center;
            padding: 2rem 1rem;
            color: var(--text-light);
        }

        .favorites-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .favorite-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: var(--bg);
            border-radius: 10px;
            border-left: 4px solid var(--primary);
        }

        .favorite-item .fav-text { flex: 1; font-size: 0.9rem; }
        .favorite-item .fav-remove {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.1rem;
            opacity: 0.5;
            transition: opacity 0.2s;
        }
        .favorite-item .fav-remove:hover { opacity: 1; }

        .fav-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            padding: 0.2rem;
            opacity: 0.4;
            transition: all 0.2s;
        }
        .fav-btn:hover { opacity: 1; transform: scale(1.2); }
        .fav-btn.active { opacity: 1; }

        /* Dashboard / Historique */
        .dashboard-section {
            background: linear-gradient(135deg, var(--primary-light), #fbcfe8);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .dashboard-section h3 {
            font-size: 0.95rem;
            margin-bottom: 0.75rem;
            color: var(--primary-dark);
        }

        .history-list {
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
            max-height: 200px;
            overflow-y: auto;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0.75rem;
            background: white;
            border-radius: 8px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .history-item:hover { background: var(--bg); }
        .history-item .date { font-size: 0.75rem; color: var(--text-light); }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .stat-box {
            background: white;
            padding: 0.6rem;
            border-radius: 8px;
            text-align: center;
        }

        .stat-box .number {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-box .label {
            font-size: 0.7rem;
            color: var(--text-light);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           RESPONSIVE - MOBILE FIRST
           Base = Mobile, puis on agrandit pour tablette/desktop
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        /* Tablette (640px+) */
        @media (min-width: 640px) {
            .header {
                padding: 1.5rem 1rem;
            }
            .header h1 { font-size: 1.5rem; }
            .header p { font-size: 0.9rem; }

            .container { padding: 1rem; }

            .card {
                padding: 1.15rem;
                border-radius: 14px;
                margin-bottom: 0.9rem;
            }
            .card-title { font-size: 1.05rem; }

            .tag {
                padding: 0.4rem 0.6rem;
                font-size: 0.78rem;
                gap: 0.3rem;
            }
            .tag .emoji { font-size: 0.95rem; }
            .tags-container { gap: 0.45rem; }
        }

        /* Desktop (768px+) */
        @media (min-width: 768px) {
            .header {
                padding: 1.75rem 1rem;
            }
            .header h1 { font-size: 1.6rem; }
            .header p { font-size: 0.95rem; }

            .container { padding: 1.25rem; }

            .card {
                padding: 1.25rem;
                border-radius: 16px;
                margin-bottom: 1rem;
            }
            .card-title {
                font-size: 1.1rem;
                margin-bottom: 0.75rem;
                gap: 0.5rem;
            }

            .tag {
                padding: 0.45rem 0.7rem;
                font-size: 0.8rem;
                gap: 0.35rem;
            }
            .tag .emoji { font-size: 1rem; }
            .tags-container { gap: 0.5rem; }

            .search-bar input { min-width: 250px; }

            .chat-messages { max-height: 300px; }
        }

        /* Large Desktop (1024px+) */
        @media (min-width: 1024px) {
            .container { padding: 1.5rem; }
            .card { padding: 1.5rem; }
        }

        /* Print */
        @media print {
            .header, .chat-section, .search-section, .actions, .tabs, .api-status { display: none !important; }
            .card { box-shadow: none; border: 1px solid #ddd; break-inside: avoid; }
            .tab-content { display: block !important; }
            body { background: white; }
        }
    </style>
</head>
<body>
    <header class="header">
        <h1>âœ¨ Mon Avenir aprÃ¨s le Bac Pro ERA</h1>
        <p>DÃ©couvre les mÃ©tiers d'avenir qui s'ouvrent Ã  toi</p>
    </header>

    <main class="container">
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- VIEW: FORMULAIRE -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <div id="view-form" class="view active">
            
            <div class="card">
                <h2 class="card-title">ğŸ“ OÃ¹ habites-tu ?</h2>
                <div class="form-group">
                    <label>Ta ville</label>
                    <input type="text" id="location" value="Saint-Chamond (42400)">
                </div>
                <div class="form-group">
                    <label>Tu peux aller Ã©tudier jusqu'oÃ¹ ?</label>
                    <select id="mobility">
                        <option value="local">PrÃ¨s de chez moi (30 min)</option>
                        <option value="regional" selected>Ma rÃ©gion (Lyon, Saint-Ã‰tienne)</option>
                        <option value="national">Partout en France</option>
                        <option value="international">MÃªme Ã  l'Ã©tranger</option>
                    </select>
                </div>
            </div>

            <div class="card">
                <h2 class="card-title">ğŸ’œ Ce que tu aimes faire</h2>
                <div class="hint">Clique sur tout ce qui te correspond</div>
                <div class="tags-container" data-group="personality">
                    <div class="tag" data-value="creative"><span class="emoji">ğŸ¨</span> CrÃ©er / Imaginer</div>
                    <div class="tag" data-value="manual"><span class="emoji">ğŸ”¨</span> Fabriquer</div>
                    <div class="tag" data-value="technical"><span class="emoji">ğŸ“</span> Technique / PrÃ©cis</div>
                    <div class="tag" data-value="social"><span class="emoji">ğŸ’¬</span> Contact humain</div>
                    <div class="tag" data-value="organize"><span class="emoji">ğŸ“‹</span> Organiser</div>
                    <div class="tag" data-value="aesthetic"><span class="emoji">âœ¨</span> EsthÃ©tique</div>
                    <div class="tag" data-value="solve"><span class="emoji">ğŸ§©</span> RÃ©soudre des problÃ¨mes</div>
                    <div class="tag" data-value="lead"><span class="emoji">ğŸ‘‘</span> Diriger</div>
                </div>
            </div>

            <div class="card">
                <h2 class="card-title">ğŸ¢ Ton environnement idÃ©al</h2>
                <div class="tags-container" data-group="environment">
                    <div class="tag" data-value="office"><span class="emoji">ğŸ’»</span> Bureau</div>
                    <div class="tag" data-value="workshop"><span class="emoji">ğŸ› ï¸</span> Atelier</div>
                    <div class="tag" data-value="site"><span class="emoji">ğŸ—ï¸</span> Chantier</div>
                    <div class="tag" data-value="client"><span class="emoji">ğŸ </span> Chez clients</div>
                    <div class="tag" data-value="store"><span class="emoji">ğŸª</span> Commerce</div>
                    <div class="tag" data-value="travel"><span class="emoji">âœˆï¸</span> Voyager</div>
                    <div class="tag" data-value="independent"><span class="emoji">ğŸš€</span> IndÃ©pendante</div>
                    <div class="tag" data-value="varied"><span class="emoji">ğŸ”„</span> VariÃ©</div>
                </div>
            </div>

            <div class="card">
                <h2 class="card-title">â­ Ce qui compte pour toi</h2>
                <div class="tags-container" data-group="priorities">
                    <div class="tag" data-value="money"><span class="emoji">ğŸ’°</span> Bien gagner</div>
                    <div class="tag" data-value="passion"><span class="emoji">â¤ï¸</span> Passion</div>
                    <div class="tag" data-value="stability"><span class="emoji">ğŸ </span> StabilitÃ©</div>
                    <div class="tag" data-value="freedom"><span class="emoji">ğŸ¦‹</span> LibertÃ©</div>
                    <div class="tag" data-value="evolution"><span class="emoji">ğŸ“ˆ</span> Ã‰volution rapide</div>
                    <div class="tag" data-value="balance"><span class="emoji">âš–ï¸</span> Ã‰quilibre vie</div>
                    <div class="tag" data-value="meaning"><span class="emoji">ğŸŒ</span> Sens / UtilitÃ©</div>
                    <div class="tag" data-value="prestige"><span class="emoji">â­</span> Prestige</div>
                </div>
                
                <div class="form-group" style="margin-top: 1rem;">
                    <label>Combien de temps tu veux Ã©tudier ?</label>
                    <div class="slider-wrapper">
                        <input type="range" class="slider" id="studyDuration" min="0" max="5" value="2">
                        <div class="slider-labels">
                            <span>Travailler vite</span>
                            <span>Longues Ã©tudes</span>
                        </div>
                        <div class="slider-value" id="studyValue">2 ans max (BTS)</div>
                    </div>
                </div>

                <div class="form-group">
                    <label>L'alternance t'intÃ©resse ?</label>
                    <select id="alternance">
                        <option value="yes">Oui, je prÃ©fÃ¨re</option>
                        <option value="maybe" selected>Pourquoi pas</option>
                        <option value="no">Non</option>
                    </select>
                </div>
            </div>

            <div class="card">
                <h2 class="card-title">ğŸŒˆ Secteurs qui t'attirent</h2>
                <div class="hint">Coche mÃªme ce qui te semble loin de ton Bac Pro - on va te montrer comment y accÃ©der !</div>
                <div class="tags-container" data-group="sectors">
                    <div class="tag" data-value="interior"><span class="emoji">ğŸ›‹ï¸</span> DÃ©co intÃ©rieure</div>
                    <div class="tag" data-value="architecture"><span class="emoji">ğŸ›ï¸</span> Architecture</div>
                    <div class="tag" data-value="luxury"><span class="emoji">ğŸ’</span> Luxe</div>
                    <div class="tag" data-value="events"><span class="emoji">ğŸª</span> Ã‰vÃ©nementiel</div>
                    <div class="tag" data-value="cinema"><span class="emoji">ğŸ¬</span> CinÃ©ma / TV</div>
                    <div class="tag" data-value="theater"><span class="emoji">ğŸ­</span> Spectacle</div>
                    <div class="tag" data-value="museum"><span class="emoji">ğŸ–¼ï¸</span> MusÃ©es / Expos</div>
                    <div class="tag" data-value="retail"><span class="emoji">ğŸ¬</span> Boutiques</div>
                    <div class="tag" data-value="hotel"><span class="emoji">ğŸ¨</span> HÃ´tellerie</div>
                    <div class="tag" data-value="boats"><span class="emoji">â›µ</span> Yachts / Bateaux</div>
                    <div class="tag" data-value="real-estate"><span class="emoji">ğŸ </span> Immobilier</div>
                    <div class="tag" data-value="furniture"><span class="emoji">ğŸª‘</span> Meubles</div>
                    <div class="tag" data-value="digital"><span class="emoji">ğŸ–¥ï¸</span> 3D / BIM / Digital</div>
                    <div class="tag" data-value="eco"><span class="emoji">ğŸŒ¿</span> Ã‰co-construction</div>
                    <div class="tag" data-value="craft"><span class="emoji">ğŸ¨</span> Artisanat d'art</div>
                    <div class="tag" data-value="sales"><span class="emoji">ğŸ¤</span> Commerce</div>
                </div>
            </div>

            <div class="card">
                <h2 class="card-title">ğŸ’­ Un rÃªve en particulier ?</h2>
                <div class="form-group">
                    <input type="text" id="dream" placeholder="Ex: travailler dans le cinÃ©ma, crÃ©er ma boÃ®te, travailler dans le luxe...">
                </div>
            </div>

            <button class="btn btn-primary" onclick="startExploration()">
                ğŸ”® DÃ©couvrir mes possibilitÃ©s et mÃ©tiers d'avenir
            </button>

            <div style="text-align: center; margin-top: 1rem;">
                <a href="/qrcode.html" style="color: var(--primary); font-size: 0.85rem; text-decoration: none;">
                    ğŸ“± Ouvrir sur iPhone ? Afficher le QR code
                </a>
            </div>

            <div class="api-status" id="apiStatus"></div>
        </div>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- VIEW: LOADING -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <div id="view-loading" class="view">
            <div class="card">
                <div class="loading-container">
                    <div class="loading-spinner"></div>
                    <h3 style="margin-bottom: 0.5rem;">Exploration en cours...</h3>
                    <p style="color: var(--text-light); font-size: 0.9rem;">Les IA travaillent ensemble pour trouver tes possibilitÃ©s</p>
                    
                    <div class="loading-phases">
                        <div class="phase-item" id="phase1">
                            <div class="phase-icon">1</div>
                            <span>Recherche des Ã©coles et formations...</span>
                        </div>
                        <div class="phase-item" id="phase2">
                            <div class="phase-icon">2</div>
                            <span>Exploration des mÃ©tiers d'avenir...</span>
                        </div>
                        <div class="phase-item" id="phase3">
                            <div class="phase-icon">3</div>
                            <span>CrÃ©ation de ton rapport personnalisÃ©...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- VIEW: RÃ‰SULTATS -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <div id="view-results" class="view">

            <!-- Dashboard -->
            <div class="dashboard-section" id="dashboardSection">
                <h3>ğŸ“Š Mon tableau de bord</h3>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="number" id="statSearches">1</div>
                        <div class="label">Explorations</div>
                    </div>
                    <div class="stat-box">
                        <div class="number" id="statFavorites">0</div>
                        <div class="label">Favoris</div>
                    </div>
                </div>
                <div id="historySection" style="margin-top: 0.75rem; display: none;">
                    <h4 style="font-size: 0.85rem; margin-bottom: 0.5rem;">ğŸ“œ Historique</h4>
                    <div class="history-list" id="historyList"></div>
                </div>
            </div>

            <div class="profile-summary">
                <strong>ğŸ“ Ton profil :</strong>
                <div class="profile-tags" id="profileTags"></div>
            </div>

            <div class="card">
                <div class="tabs">
                    <button class="tab-btn active" onclick="showTab('synthesis')">ğŸ¯ SynthÃ¨se</button>
                    <button class="tab-btn" onclick="showTab('favorites')">â­ Mes favoris</button>
                    <button class="tab-btn" onclick="showTab('details')">ğŸ“š DÃ©tails</button>
                </div>

                <div id="tab-synthesis" class="tab-content active">
                    <p class="favorites-hint">ğŸ’¡ Clique sur â¤ï¸ Ã  cÃ´tÃ© d'un mÃ©tier ou formation pour l'ajouter Ã  tes favoris</p>
                    <div class="report" id="synthesisContent"></div>
                </div>

                <div id="tab-favorites" class="tab-content">
                    <div id="favoritesEmpty" class="favorites-empty">
                        <p>â­ Tu n'as pas encore de favoris</p>
                        <p class="hint">Clique sur â¤ï¸ dans la synthÃ¨se pour ajouter des mÃ©tiers ou formations Ã  ta liste</p>
                    </div>
                    <div id="favoritesList" class="favorites-list"></div>
                    <button id="clearFavorites" class="btn btn-secondary" onclick="clearFavorites()" style="display:none; margin-top: 1rem;">ğŸ—‘ï¸ Vider mes favoris</button>
                </div>

                <div id="tab-details" class="tab-content">
                    <div class="expandable" id="exp-research">
                        <div class="expandable-header" onclick="toggleExpand('exp-research')">
                            ğŸ” Recherche web (Ã©coles, formations)
                            <span>â–¼</span>
                        </div>
                        <div class="expandable-content report" id="researchContent"></div>
                    </div>
                    <div class="expandable" id="exp-careers">
                        <div class="expandable-header" onclick="toggleExpand('exp-careers')">
                            ğŸ’¼ MÃ©tiers structurÃ©s
                            <span>â–¼</span>
                        </div>
                        <div class="expandable-content report" id="careersContent"></div>
                    </div>
                    <div class="expandable" id="exp-creative">
                        <div class="expandable-header" onclick="toggleExpand('exp-creative')">
                            ğŸŒŸ MÃ©tiers crÃ©atifs et originaux
                            <span>â–¼</span>
                        </div>
                        <div class="expandable-content report" id="creativeContent"></div>
                    </div>
                </div>

                <!-- Recherche spÃ©cifique -->
                <div class="search-section">
                    <h3 style="margin-bottom: 0.75rem; font-size: 0.95rem;">ğŸ” Rechercher quelque chose de prÃ©cis</h3>
                    <div class="search-bar">
                        <input type="text" id="searchQuery" placeholder="Ex: Ã©coles de cinÃ©ma, BIM manager, formation nautisme...">
                        <select id="searchScope">
                            <option value="auto">Auto</option>
                            <option value="regional">Ma rÃ©gion</option>
                            <option value="national">France entiÃ¨re</option>
                        </select>
                        <button class="btn btn-secondary" onclick="doSearch()">Chercher</button>
                    </div>
                    <div id="searchResult" class="search-result" style="display: none;"></div>
                </div>

                <!-- Chat -->
                <div class="chat-section">
                    <h3 style="margin-bottom: 0.75rem; font-size: 0.95rem;">ğŸ’¬ Une question ?</h3>
                    <div class="chat-messages" id="chatMessages"></div>
                    <div class="chat-input">
                        <input type="text" id="chatInput" placeholder="Pose ta question..." onkeypress="if(event.key==='Enter')sendChat()">
                        <button class="btn btn-secondary" onclick="sendChat()">Envoyer</button>
                    </div>
                </div>
            </div>

            <div class="actions">
                <button class="btn btn-secondary" onclick="restart()">ğŸ”„ Recommencer</button>
                <button class="btn btn-secondary" onclick="window.print()">ğŸ–¨ï¸ Imprimer</button>
                <button class="btn btn-secondary" onclick="window.open('/qrcode.html', '_blank')">ğŸ“± Partager sur iPhone</button>
            </div>
        </div>
    </main>

    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // STATE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const profile = {
            location: 'Saint-Chamond (42400)',
            mobility: 'regional',
            personality: [],
            environment: [],
            priorities: [],
            sectors: [],
            studyDuration: 2,
            alternance: 'maybe',
            dream: ''
        };

        let resultsData = null;

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // INIT
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        document.addEventListener('DOMContentLoaded', () => {
            checkApiStatus();
            setupTags();
            setupSlider();
        });

        async function checkApiStatus() {
            try {
                const res = await fetch('/api/status');
                const status = await res.json();
                document.getElementById('apiStatus').innerHTML = `
                    <span class="api-badge ${status.claude ? 'ok' : 'error'}">Claude ${status.claude ? 'âœ“' : 'âœ—'}</span>
                    <span class="api-badge ${status.openai ? 'ok' : 'error'}">GPT ${status.openai ? 'âœ“' : 'âœ—'}</span>
                    <span class="api-badge ${status.perplexity ? 'ok' : 'error'}">Perplexity ${status.perplexity ? 'âœ“' : 'âœ—'}</span>
                `;
            } catch (e) { console.error(e); }
        }

        function setupTags() {
            document.querySelectorAll('.tag').forEach(tag => {
                tag.onclick = () => {
                    tag.classList.toggle('selected');
                    const group = tag.closest('.tags-container').dataset.group;
                    const value = tag.dataset.value;
                    if (tag.classList.contains('selected')) {
                        if (!profile[group].includes(value)) profile[group].push(value);
                    } else {
                        profile[group] = profile[group].filter(v => v !== value);
                    }
                };
            });
        }

        function setupSlider() {
            const slider = document.getElementById('studyDuration');
            const labels = ['Travailler direct', '1 an (MC)', '2 ans (BTS)', '3 ans (Licence/BUT/DN MADE)', '4 ans', '5 ans (Master/DSAA)'];
            slider.oninput = () => {
                profile.studyDuration = parseInt(slider.value);
                document.getElementById('studyValue').textContent = labels[profile.studyDuration];
            };
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // EXPLORATION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function startExploration() {
            // Collect data
            profile.location = document.getElementById('location').value || 'France';
            profile.mobility = document.getElementById('mobility').value;
            profile.alternance = document.getElementById('alternance').value;
            profile.dream = document.getElementById('dream').value;

            showView('loading');
            
            // Animate phases
            setTimeout(() => document.getElementById('phase1').classList.add('active'), 100);
            
            try {
                const response = await fetch('/api/explore', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ profile })
                });

                document.getElementById('phase1').classList.replace('active', 'done');
                document.getElementById('phase2').classList.add('active');
                await sleep(400);
                
                document.getElementById('phase2').classList.replace('active', 'done');
                document.getElementById('phase3').classList.add('active');
                await sleep(400);
                
                document.getElementById('phase3').classList.replace('active', 'done');

                resultsData = await response.json();
                displayResults();
                showView('results');

            } catch (error) {
                alert('Erreur: ' + error.message);
                showView('form');
            }
        }

        function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

        function displayResults() {
            // Profile summary
            const tags = [`ğŸ“ ${profile.location}`];
            const maps = {
                personality: { creative: 'ğŸ¨ CrÃ©ative', manual: 'ğŸ”¨ Manuelle', technical: 'ğŸ“ Technique', social: 'ğŸ’¬ Sociale', organize: 'ğŸ“‹ OrganisÃ©e', aesthetic: 'âœ¨ EsthÃ¨te', solve: 'ğŸ§© Problem-solver', lead: 'ğŸ‘‘ Leader' },
                environment: { office: 'ğŸ’» Bureau', workshop: 'ğŸ› ï¸ Atelier', site: 'ğŸ—ï¸ Chantier', client: 'ğŸ  Terrain', store: 'ğŸª Commerce', travel: 'âœˆï¸ Mobile', independent: 'ğŸš€ IndÃ©pendante', varied: 'ğŸ”„ Polyvalent' },
                priorities: { money: 'ğŸ’° Salaire', passion: 'â¤ï¸ Passion', stability: 'ğŸ  StabilitÃ©', freedom: 'ğŸ¦‹ LibertÃ©', evolution: 'ğŸ“ˆ Ã‰volution', balance: 'âš–ï¸ Ã‰quilibre', meaning: 'ğŸŒ Sens', prestige: 'â­ Prestige' },
                sectors: { interior: 'ğŸ›‹ï¸ DÃ©co', architecture: 'ğŸ›ï¸ Archi', luxury: 'ğŸ’ Luxe', events: 'ğŸª Event', cinema: 'ğŸ¬ CinÃ©', theater: 'ğŸ­ Spectacle', museum: 'ğŸ–¼ï¸ MusÃ©es', retail: 'ğŸ¬ Retail', hotel: 'ğŸ¨ HÃ´tel', boats: 'â›µ Nautisme', 'real-estate': 'ğŸ  Immo', furniture: 'ğŸª‘ Meubles', digital: 'ğŸ–¥ï¸ Digital', eco: 'ğŸŒ¿ Ã‰co', craft: 'ğŸ¨ Artisanat', sales: 'ğŸ¤ Commerce' }
            };

            ['personality', 'environment', 'priorities', 'sectors'].forEach(g => {
                profile[g].forEach(v => { if (maps[g]?.[v]) tags.push(maps[g][v]); });
            });

            tags.push(`ğŸ“š ${profile.studyDuration} ans max`);
            if (profile.dream) tags.push(`ğŸ’­ ${profile.dream.substring(0, 20)}...`);

            document.getElementById('profileTags').innerHTML = tags.map(t => `<span class="profile-tag">${t}</span>`).join('');

            // Content avec boutons favoris
            const synthesisHtml = addFavoriteButtons(md(resultsData.synthesis || 'Rapport non disponible'));
            document.getElementById('synthesisContent').innerHTML = synthesisHtml;
            document.getElementById('researchContent').innerHTML = md(resultsData.details?.research || 'Non disponible');
            document.getElementById('careersContent').innerHTML = md(resultsData.details?.careers_structured || 'Non disponible');
            document.getElementById('creativeContent').innerHTML = md(resultsData.details?.careers_creative || 'Non disponible');

            // Sauvegarder dans l'historique
            saveToHistory();
            updateDashboard();
            loadFavorites();
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // FAVORIS & HISTORIQUE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        let favorites = JSON.parse(localStorage.getItem('era_favorites') || '[]');
        let history = JSON.parse(localStorage.getItem('era_history') || '[]');

        function addFavoriteButtons(html) {
            // Ajoute des boutons â¤ï¸ aprÃ¨s les titres de mÃ©tiers (lignes commenÃ§ant par **)
            return html.replace(/<strong>([^<]+)<\/strong>/g, (match, text) => {
                // Ne pas ajouter aux en-tÃªtes de tableau
                if (text.includes('|') || text.length > 50) return match;
                const id = text.replace(/[^a-zA-Z0-9]/g, '_').substring(0, 30);
                const isActive = favorites.some(f => f.id === id) ? 'active' : '';
                return `<strong>${text}</strong> <button class="fav-btn ${isActive}" onclick="toggleFavorite('${id}', '${text.replace(/'/g, "\\'")}')">â¤ï¸</button>`;
            });
        }

        function toggleFavorite(id, text) {
            const index = favorites.findIndex(f => f.id === id);
            if (index >= 0) {
                favorites.splice(index, 1);
            } else {
                favorites.push({ id, text, date: new Date().toLocaleDateString('fr-FR') });
            }
            localStorage.setItem('era_favorites', JSON.stringify(favorites));

            // Mettre Ã  jour les boutons
            document.querySelectorAll('.fav-btn').forEach(btn => {
                const btnId = btn.onclick.toString().match(/'([^']+)'/)?.[1];
                if (btnId === id) btn.classList.toggle('active');
            });

            updateDashboard();
            loadFavorites();
        }

        function loadFavorites() {
            const list = document.getElementById('favoritesList');
            const empty = document.getElementById('favoritesEmpty');
            const clearBtn = document.getElementById('clearFavorites');

            if (favorites.length === 0) {
                empty.style.display = 'block';
                list.innerHTML = '';
                clearBtn.style.display = 'none';
            } else {
                empty.style.display = 'none';
                clearBtn.style.display = 'block';
                list.innerHTML = favorites.map(f => `
                    <div class="favorite-item">
                        <span class="fav-text">â­ ${f.text}</span>
                        <span class="date">${f.date}</span>
                        <button class="fav-remove" onclick="toggleFavorite('${f.id}', '${f.text.replace(/'/g, "\\'")}')">âœ•</button>
                    </div>
                `).join('');
            }
        }

        function clearFavorites() {
            if (confirm('Vider tous tes favoris ?')) {
                favorites = [];
                localStorage.setItem('era_favorites', JSON.stringify(favorites));
                loadFavorites();
                updateDashboard();
                // Mettre Ã  jour tous les boutons
                document.querySelectorAll('.fav-btn').forEach(btn => btn.classList.remove('active'));
            }
        }

        function saveToHistory() {
            const entry = {
                date: new Date().toLocaleString('fr-FR'),
                profile: { ...profile },
                id: Date.now()
            };
            history.unshift(entry);
            if (history.length > 10) history = history.slice(0, 10); // Garder les 10 derniers
            localStorage.setItem('era_history', JSON.stringify(history));
        }

        function updateDashboard() {
            document.getElementById('statSearches').textContent = history.length || 1;
            document.getElementById('statFavorites').textContent = favorites.length;

            const historySection = document.getElementById('historySection');
            const historyList = document.getElementById('historyList');

            if (history.length > 1) {
                historySection.style.display = 'block';
                historyList.innerHTML = history.slice(0, 5).map(h => `
                    <div class="history-item" onclick="viewHistory(${h.id})">
                        <span>ğŸ” ${h.profile.sectors?.slice(0, 2).join(', ') || 'Exploration'}</span>
                        <span class="date">${h.date.split(' ')[0]}</span>
                    </div>
                `).join('');
            }
        }

        function viewHistory(id) {
            const entry = history.find(h => h.id === id);
            if (entry) {
                alert(`Exploration du ${entry.date}\nSecteurs: ${entry.profile.sectors?.join(', ') || 'Non spÃ©cifiÃ©s'}\nMobilitÃ©: ${entry.profile.mobility}`);
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // TABS & EXPAND
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function showTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelector(`[onclick="showTab('${tab}')"]`).classList.add('active');
            document.getElementById(`tab-${tab}`).classList.add('active');
        }

        function toggleExpand(id) {
            document.getElementById(id).classList.toggle('open');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SEARCH
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function doSearch() {
            const query = document.getElementById('searchQuery').value.trim();
            if (!query) return;

            const scope = document.getElementById('searchScope').value;
            const container = document.getElementById('searchResult');
            container.style.display = 'block';
            container.innerHTML = '<div class="loading-spinner" style="width:30px;height:30px;margin:1rem auto;"></div>';

            try {
                const res = await fetch('/api/search', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query, scope, profile })
                });
                const data = await res.json();
                container.innerHTML = `<div class="report">${md(data.response || data.error)}</div>`;
            } catch (e) {
                container.innerHTML = '<p style="color:red;">Erreur</p>';
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // CHAT
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function sendChat() {
            const input = document.getElementById('chatInput');
            const question = input.value.trim();
            if (!question) return;

            const container = document.getElementById('chatMessages');
            container.innerHTML += `<div class="chat-msg user">${question}</div>`;
            input.value = '';

            const loadingId = 'load-' + Date.now();
            container.innerHTML += `<div class="chat-msg ai" id="${loadingId}">â³...</div>`;
            container.scrollTop = container.scrollHeight;

            try {
                const res = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ question, context: { profile, synthesis: resultsData?.synthesis?.substring(0, 2000) } })
                });
                const data = await res.json();
                document.getElementById(loadingId).innerHTML = md(data.response || data.error);
            } catch (e) {
                document.getElementById(loadingId).textContent = 'Erreur';
            }
            container.scrollTop = container.scrollHeight;
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // UTILS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function showView(view) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(`view-${view}`).classList.add('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function restart() {
            profile.personality = [];
            profile.environment = [];
            profile.priorities = [];
            profile.sectors = [];
            document.querySelectorAll('.tag').forEach(t => t.classList.remove('selected'));
            document.getElementById('chatMessages').innerHTML = '';
            document.getElementById('searchResult').style.display = 'none';
            showView('form');
        }

        function md(text) {
            if (!text) return '';
            return text
                .replace(/^####\s(.+)$/gm, '<h4>$1</h4>')
                .replace(/^###\s(.+)$/gm, '<h3>$1</h3>')
                .replace(/^##\s(.+)$/gm, '<h2>$1</h2>')
                .replace(/^#\s(.+)$/gm, '<h1>$1</h1>')
                .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
                .replace(/\|(.+)\|/g, (match) => {
                    const cells = match.split('|').filter(c => c.trim());
                    if (cells.every(c => c.trim().match(/^[-:]+$/))) return '';
                    const tag = match.includes('---') ? 'th' : 'td';
                    return '<tr>' + cells.map(c => `<${tag}>${c.trim()}</${tag}>`).join('') + '</tr>';
                })
                .replace(/(<tr>.*<\/tr>\n?)+/g, '<table>$&</table>')
                .replace(/^\-\s(.+)$/gm, '<li>$1</li>')
                .replace(/^\*\s(.+)$/gm, '<li>$1</li>')
                .replace(/^(\d+)\.\s(.+)$/gm, '<li>$2</li>')
                .replace(/(<li>[\s\S]*?<\/li>)/g, '<ul>$1</ul>')
                .replace(/<\/ul>\s*<ul>/g, '')
                .replace(/\n\n/g, '</p><p>')
                .replace(/\n/g, '<br>')
                .replace(/^/, '<p>')
                .replace(/$/, '</p>')
                .replace(/<p><\/p>/g, '')
                .replace(/<p>(<[hut])/g, '$1')
                .replace(/(<\/[hut][^>]*>)<\/p>/g, '$1');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SERVICE WORKER - PWA
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('Service Worker enregistrÃ©:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('Erreur Service Worker:', error);
                    });
            });
        }
    </script>
</body>
</html>
